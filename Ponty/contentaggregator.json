{
  "plugins": [
    {
      "assemblyName": "ContentAggregator.Contentful"
    },
    {
      "assemblyName": "ContentAggregator.ElasticSearch"
    }
  ],
  "inputs": {
    "scheduler": {
      "type": "scheduler",
      "interval": "00:01:00"
    },
    "elasticsearch": {
      "type": "elasticsearch", 
      "url": "http://${elasticsearch|localhost}:9200",
      "termMappings": [
      ]
    }
  },

  "pipelines": [
    {
      "inputs": [
        { "name": "scheduler" },
      ],
      "tasks": [
        { "type": "httpget", "url": "https://boxhill.ponty-system.se/extapi/job?p=gAAAAABWH1PwNdUderZKgnQfC5krfE_1e6mDXrVW5lE6LxwQM6toDKSgw5iCTkb1Hia94j8Uo5U-K4XcSpquklrAyFVsF5ZRbQ==" },
        { "type": "select", "path": "jobs[*]" }
      ],
      "outputs": [
        { "name": "elasticsearch", "index": "ponty", "type": "job", "key": "#{assignment_id}" },
        { "name": "queue", "topic": "ponty_image" }      
      ] 
    },
    {
      "inputs": [
        { "name": "queue", "topic": "ponty_image" }
      ],

      "tasks": [
        { "type": "httpget", "url": "#{image_url}", "format": "binary" },
        { "type": "module", "module": "ImageResize", "function": "ImageResize"}
      ],
      "outputs": [
        { "name": "file", "path": "/var/images", "filename": "#{assignment_id}.png" }
      ]
    } 
  ]
}
